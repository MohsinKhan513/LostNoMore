<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LostNoMore ‚Äî Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231e40af'/%3E%3Ctext x='50' y='65' font-size='52' text-anchor='middle' fill='white' font-family='Inter, Arial' font-weight='700'%3EL%3C/text%3E%3C/svg%3E" />
</head>

<body class="app-root">

  <header class="topbar" id="topbar" aria-hidden="true">
    <div class="container topbar-inner">
      <div class="brand">
        <div class="brand-mark"></div>
        <h1>LostNoMore</h1>
      </div>
      <nav class="nav">
        <button id="nav-all-items" class="nav-btn">All Items</button>
        <button id="nav-my-reports" class="nav-btn">My Reports</button>
        <button id="nav-report-item" class="nav-btn primary">Report Item</button>
        <button id="nav-profile" class="nav-btn nav-profile-btn" title="View Profile"></button>
        <button id="nav-logout" class="nav-btn danger">Logout</button>
      </nav>
    </div>
  </header>

  <div id="message-bar" class="message hidden" role="status" aria-live="polite"></div>

  <main class="container main" id="main">

    <section id="view-login" class="view card auth-card">
      <div class="auth-header">
        <h2 class="title">Welcome back</h2>
        <p class="muted">Sign in to access the LostNoMore portal</p>
      </div>
      <form id="login-form" class="form">
        <label class="label">
          Email
          <input id="login-email" name="email" type="email" required class="input" placeholder="you@university.edu">
        </label>
        <label class="label">
          Password
          <input id="login-password" name="password" type="password" required class="input" placeholder="Your password">
        </label>
        <button type="submit" class="btn btn-primary btn-block">Sign In</button>
      </form>
      <p class="small text-center">Don't have an account? <a id="link-to-register" href="#" class="link">Create one</a>
      </p>
    </section>

    <section id="view-register" class="view card auth-card hidden">
      <div class="auth-header">
        <h2 class="title">Create account</h2>
        <p class="muted">Use your university email to register</p>
      </div>
      <form id="register-form" class="form">
        <label class="label">
          Full name
          <input id="register-name" name="name" type="text" required class="input" placeholder="Jane Doe">
        </label>
        <label class="label">
          University email
          <input id="register-email" name="email" type="email" required class="input" placeholder="you@nu.edu.pk">
        </label>
        <label class="label">
          Phone Number
          <input id="register-phone" name="phone" type="tel" required class="input" placeholder="+923001234567"
            pattern="^\+[1-9]\d{7,14}$" />
        </label>
        <label class="label">
          Password
          <input id="register-password" name="password" type="password" required class="input"
            placeholder="Create a secure password">
        </label>
        <button type="submit" class="btn btn-primary btn-block">Register</button>
      </form>
      <p class="small text-center">Already registered? <a id="link-to-login" href="#" class="link">Sign in</a></p>
    </section>

    <section id="view-dashboard" class="view hidden">
      <div class="panel-header">
        <h2>All Reported Items</h2>
        <div class="header-actions">
          <button id="toggle-search" class="btn btn-secondary">üîç Search & Filter</button>
          <button id="refresh-items" class="btn btn-secondary">Refresh</button>
          <button id="btn-new-report" class="btn primary">Report Item</button>
        </div>
      </div>
      
      <!-- Search and Filter Panel (US-19, US-20, US-21, US-22, US-23) -->
      <div id="search-filter-panel" class="card hidden" style="margin-bottom: 20px;">
        <h3 style="margin-top: 0;">Search & Filter</h3>
        <form id="search-filter-form" class="form">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
            <label class="label">
              Keyword
              <input id="search-keyword" name="keyword" type="text" class="input" placeholder="Search by name or description...">
            </label>
            <label class="label">
              Category
              <select id="search-category" name="category" class="input">
                <option value="">All Categories</option>
                <option>Electronics</option>
                <option>Apparel</option>
                <option>Keys/Cards</option>
                <option>Books/Notes</option>
                <option>Other</option>
              </select>
            </label>
            <label class="label">
              Location
              <input id="search-location" name="location" type="text" class="input" placeholder="Building or area...">
            </label>
            <label class="label">
              Type
              <select id="search-type" name="itemType" class="input">
                <option value="">All Types</option>
                <option value="lost">Lost</option>
                <option value="found">Found</option>
              </select>
            </label>
            <label class="label">
              Status
              <select id="search-status" name="status" class="input">
                <option value="">All Statuses</option>
                <option value="active">Active</option>
                <option value="recovered">Recovered</option>
                <option value="returned">Returned</option>
              </select>
            </label>
            <label class="label">
              From Date
              <input id="search-date-from" name="dateFrom" type="date" class="input">
            </label>
            <label class="label">
              To Date
              <input id="search-date-to" name="dateTo" type="date" class="input">
            </label>
            <label class="label">
              Sort By
              <select id="search-sort" name="sortBy" class="input">
                <option value="createdAt">Date Posted</option>
                <option value="title">Item Name</option>
                <option value="category">Category</option>
                <option value="location">Location</option>
              </select>
            </label>
            <label class="label">
              Order
              <select id="search-order" name="sortOrder" class="input">
                <option value="desc">Newest First</option>
                <option value="asc">Oldest First</option>
              </select>
            </label>
          </div>
          <div class="form-actions" style="margin-top: 16px;">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
            <button type="button" id="clear-filters" class="btn btn-secondary">Clear All</button>
          </div>
        </form>
      </div>
      
      <div id="dashboard-items-container" class="grid cards-grid"></div>
    </section>

    <section id="view-my-reports" class="view hidden">
      <div class="panel-header">
        <h2>My Reports</h2>
        <div class="tab-group" id="my-reports-filter-tabs">
          <button class="tab-btn active" data-filter="all">All</button>
          <button class="tab-btn" data-filter="lost">Lost</button>
          <button class="tab-btn" data-filter="found">Found</button>
        </div>
      </div>
      <div id="my-reports-items-container" class="grid cards-grid"></div>
    </section>

    <section id="view-report-type" class="view card report-type-view hidden">
      <div class="auth-header">
        <h2 class="title">Report Type</h2>
        <p class="muted">Are you reporting a lost item or reporting that you found an item?</p>
      </div>
      <div class="report-type-grid">
        <label class="type-card">
          <input type="radio" name="reportType" value="lost" checked class="sr-only" />
          <div class="type-card-inner">
            <div class="type-emoji">üîç</div>
            <h3>I Lost Something</h3>
            <p class="muted small">You're looking for your item.</p>
          </div>
        </label>
        <label class="type-card">
          <input type="radio" name="reportType" value="found" class="sr-only" />
          <div class="type-card-inner">
            <div class="type-emoji">üì¶</div>
            <h3>I Found Something</h3>
            <p class="muted small">You want to report an item you found.</p>
          </div>
        </label>
      </div>
      <div class="form-actions">
        <button id="report-type-cancel" class="btn btn-secondary">Cancel</button>
      </div>
    </section>

    <section id="view-report-details" class="view card hidden">
      <div class="auth-header">
        <h2 class="title" style="text-align: center;">Item Details</h2>
      </div>
      <form id="report-form" class="form" enctype="multipart/form-data">
        <fieldset class="fieldset">
          <label class="label">
            Item Name
            <input id="report-title" name="title" type="text" required class="input"
              placeholder="Black wallet, Blue water bottle...">
          </label>
          <label class="label">
            Description
            <textarea id="report-description" name="description" rows="3" required class="input"
              placeholder="Describe marks, contents, brand, where it was last seen..."></textarea>
          </label>
          <label class="label">
            Category
            <select id="report-category" name="category" required class="input">
              <option value="">Select a category...</option>
              <option>Electronics</option>
              <option>Apparel</option>
              <option>Keys/Cards</option>
              <option>Books/Notes</option>
              <option>Other</option>
            </select>
          </label>
          <label class="label">
            Last Known Location
            <input id="report-location" name="location" type="text" required class="input"
              placeholder="Library, Cafe, Hill Side...">
          </label>
          <label class="label">
            Upload Image (optional)
            <input id="report-image" name="itemImage" type="file" accept="image/*" class="input-file">
          </label>
        </fieldset>
        <div class="form-actions">
          <button id="report-back" type="button" class="btn btn-secondary">Back</button>
          <button type="submit" class="btn btn-primary">Submit Report</button>
        </div>
      </form>
    </section>

    <section id="view-item-details" class="view hidden">
      <div class="panel-header">
        <button id="back-to-dashboard" class="btn btn-secondary">‚Üê Back</button>
        <div id="item-owner-actions" class="header-actions hidden">
          <button id="edit-item-btn" class="btn btn-secondary">Edit</button>
          <button id="mark-recovered-btn" class="btn btn-secondary">Mark as Recovered/Returned</button>
          <button id="delete-item-btn" class="btn danger">Delete</button>
        </div>
      </div>
      <article class="detail-panel card">
        <div class="detail-media">
          <img id="details-image" src="" alt="Item image" />
        </div>
        <div class="detail-body">
          <span id="details-type" class="badge"></span>
          <span id="details-status" class="badge" style="margin-left: 8px;"></span>
          <h2 id="details-title" class="detail-title"></h2>
          <p id="details-description" class="muted"></p>
          <dl class="detail-list">
            <div>
              <dt>Category:</dt>
              <dd id="details-category"></dd>
            </div>
            <div>
              <dt>Location:</dt>
              <dd id="details-location"></dd>
            </div>
            <div>
              <dt>Reported By:</dt>
              <dd id="details-reporter-name"></dd>
            </div>

            <div>
              <dt>Contact Email:</dt>
              <dd id="details-reporter-email"></dd>
            </div>

            <div>
              <dt>Contact Mobile:</dt>
              <dd id="details-reporter-mobile"></dd>
            </div>

            <div id="details-whatsapp-row" class="hidden">
              <dt>WhatsApp:</dt>
              <dd id="details-reporter-whatsapp"></dd>
            </div>

            <div>
              <dt>Reported On:</dt>
              <dd id="details-date"></dd>
            </div>
          </dl>
        </div>
      </article>
    </section>

    <!-- NEW: Profile View Section -->
    <section id="view-profile" class="view hidden">
      <div class="panel-header">
        <button id="profile-back" class="btn btn-secondary">‚Üê Back</button>
      </div>
      <div class="profile-container card">
        <div class="profile-header">
          <div class="profile-avatar-wrapper">
            <img id="profile-avatar" class="profile-avatar" src="" alt="Profile Picture" />
            <label for="profile-picture-input" class="profile-avatar-upload">
              <span>üì∑</span>
              <input id="profile-picture-input" name="profilePicture" type="file" accept="image/*" class="sr-only" />
            </label>
          </div>
          <div class="profile-info">
            <h2 id="profile-name" class="profile-name"></h2>
            <p id="profile-email" class="profile-email muted"></p>
          </div>
        </div>

        <form id="profile-form" class="form" enctype="multipart/form-data">
          <fieldset class="fieldset">
            <legend class="legend">Update Contact Information (US-06)</legend>
            <label class="label">
              Phone Number
              <input id="profile-phone-input" name="phone" type="tel" required class="input" placeholder="+923001234567"
                pattern="^\+[1-9]\d{7,14}$" />
            </label>
            <p class="muted small" style="margin-top: -6px;">Current: <span id="profile-phone-display"></span></p>
            
            <label class="label">
              WhatsApp Number (Optional)
              <input id="profile-whatsapp-input" name="whatsapp" type="tel" class="input" placeholder="+923001234567"
                pattern="^\+[1-9]\d{7,14}$" />
            </label>
            <p class="muted small" style="margin-top: -6px;">Current: <span id="profile-whatsapp-display">Not set</span></p>
          </fieldset>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Contact Info</button>
          </div>
        </form>

        <form id="password-reset-form" class="form" style="margin-top: 24px;">
          <fieldset class="fieldset">
            <legend class="legend">Change Password (US-07)</legend>
            <label class="label">
              Current Password
              <input id="current-password" name="currentPassword" type="password" required class="input" placeholder="Enter current password">
            </label>
            <label class="label">
              New Password
              <input id="new-password" name="newPassword" type="password" required class="input" placeholder="Enter new password" minlength="6">
            </label>
            <label class="label">
              Confirm New Password
              <input id="confirm-password" name="confirmPassword" type="password" required class="input" placeholder="Confirm new password" minlength="6">
            </label>
          </fieldset>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Change Password</button>
          </div>
        </form>
      </div>
    </section>

    <!-- NEW: Edit Item View Section -->
    <section id="view-edit-item" class="view card hidden">
      <div class="auth-header">
        <h2 class="title" style="text-align: center;">Edit Item Details</h2>
      </div>
      <form id="edit-item-form" class="form" enctype="multipart/form-data">
        <input type="hidden" id="edit-item-id" name="itemId" value="">
        <fieldset class="fieldset">
          <label class="label">
            Item Name
            <input id="edit-item-title" name="title" type="text" required class="input"
              placeholder="Black wallet, Blue water bottle...">
          </label>
          <label class="label">
            Description
            <textarea id="edit-item-description" name="description" rows="3" required class="input"
              placeholder="Describe marks, contents, brand, where it was last seen..."></textarea>
          </label>
          <label class="label">
            Category
            <select id="edit-item-category" name="category" required class="input">
              <option value="">Select a category...</option>
              <option>Electronics</option>
              <option>Apparel</option>
              <option>Keys/Cards</option>
              <option>Books/Notes</option>
              <option>Other</option>
            </select>
          </label>
          <label class="label">
            Location
            <input id="edit-item-location" name="location" type="text" required class="input"
              placeholder="Library, Cafe, Hill Side...">
          </label>
          <label class="label">
            Upload New Image (optional - leave empty to keep current image)
            <input id="edit-item-image" name="itemImage" type="file" accept="image/*" class="input-file">
          </label>
        </fieldset>
        <div class="form-actions">
          <button id="edit-item-cancel" type="button" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </section>

  </main>

  <div id="loading-spinner" class="loading-overlay hidden" aria-hidden="true" role="status" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
  </div>

  <script src="app.js" defer></script>
</body>

</html>